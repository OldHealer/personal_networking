# –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: Rockfile

## –û–±–∑–æ—Ä

–ü–ª–∞–Ω —Ä–∞–∑–±–∏—Ç –Ω–∞ —Ñ–∞–∑—ã –æ—Ç MVP –¥–æ –ø–æ–ª–Ω–æ–º–∞—Å—à—Ç–∞–±–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞. –ö–∞–∂–¥–∞—è —Ñ–∞–∑–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Ä–∞–±–æ—á–∏–º –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

---

## –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–¶–µ–ª—å:** –ú–∏–≥—Ä–∞—Ü–∏–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞, –±–∞–∑–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 0.1 | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Alembic –¥–ª—è async SQLAlchemy | `alembic init`, –∫–æ–Ω—Ñ–∏–≥ –ø–æ–¥ asyncpg |
| 0.2 | –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ —Ç–µ–∫—É—â–∏–º –º–æ–¥–µ–ª—è–º | `contact_cards`, `contact_links`, `contact_interactions` |
| 0.3 | –î–æ–±–∞–≤–∏—Ç—å –≤ pyproject: pytest, pytest-asyncio, httpx | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ç–µ—Å—Ç–∞–º |
| 0.4 | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: docker-compose —Å PostgreSQL | –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –ë–î –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π |

**–í—ã—Ö–æ–¥:** –ë–î —Å–æ–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏, –ø—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ API.

---

## –§–∞–∑–∞ 1: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (Keycloak + OIDC)

**–¶–µ–ª—å:** –∑–∞—â–∏—Ç–∞ API –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–æ –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∏.

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 1.1 | –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å Keycloak –ª–æ–∫–∞–ª—å–Ω–æ | –î–æ—Å—Ç—É–ø–µ–Ω admin UI |
| 1.2 | –°–æ–∑–¥–∞—Ç—å Realm, Client, Role | –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OIDC |
| 1.3 | –í–∫–ª—é—á–∏—Ç—å self‚Äëregistration | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç |
| 1.4 | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ claims (`tenant_id`, `roles`) | JWT —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è |
| 1.5 | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É JWT –≤ FastAPI | –ó–∞—â–∏—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ |
| 1.6 | –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ tenant –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ | Self‚Äëservice, –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å |
| 1.7 | –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ `tenant_id` | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ —Å–µ—Ä–≤–∏—Å–µ/DAO |

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Keycloak (–ª–æ–∫–∞–ª—å–Ω–æ)
–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∏ —Ä–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞:
```bash
docker run -d --name rockfile-keycloak --network rockfile-network -p 8081:8080 -e KEYCLOAK_ADMIN=admin -e KEYCLOAK_ADMIN_PASSWORD=admin quay.io/keycloak/keycloak:latest start-dev
```
> ‚ö†Ô∏è –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∞—Ç—å –ë–î Keycloak –∫ –ë–î –ø—Ä–æ–µ–∫—Ç–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —Å–æ–∑–¥–∞—Å—Ç –ø–æ—á—Ç–∏ 100 —Ç–∞–±–ª–∏—Ü

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://localhost:8081`  
**üîê –î–ª—è –≤—Ö–æ–¥–∞:** `admin / admin`

–î–∞–ª–µ–µ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:
- **Realm**: `rockfile`
- **Client**: `rockfile-api` (—Ç–∏–ø: `confidential`, –≤–∫–ª—é—á–∏—Ç—å `Standard Flow`)
- **Valid Redirect URIs**: `http://localhost:3000/*` (–∏–ª–∏ URL —Ñ—Ä–æ–Ω—Ç–∞)
- **Web Origins**: `http://localhost:3000`
- **Roles**: `owner`, `admin`, `user`
- **Users**: —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–æ–ª—è –≤ —Ç–æ–∫–µ–Ω–µ
- `tenant_id` ‚Äî ID –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞
- `roles` ‚Äî —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `aud` ‚Äî `rockfile-api`
- `iss` ‚Äî URL realm

### Audience Mapper (—á—Ç–æ–±—ã `aud` –±—ã–ª `rockfile-api`)
**–ó–∞—á–µ–º:** –±–µ–∑ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ `rockfile-api` –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ API –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å.

1. `Client scopes` ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ `rockfile-api-dedicated`
2. `Mappers` ‚Üí `Create mapper`
3. –¢–∏–ø: **Audience**
4. `Included Client Audience`: `rockfile-api`
5. `Add to access token` = ON
6. `Save`

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `aud = rockfile-api`.

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Audience Mapper –ø—Ä—è–º–æ –≤ client
**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç, –µ—Å–ª–∏ `rockfile-api-dedicated` –Ω–µ –≤–∏–¥–Ω–æ –≤ Client scopes.**

1. `Clients` ‚Üí `rockfile-api`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É `Mappers` (–∏–ª–∏ `Client scopes`, –µ—Å–ª–∏ –≤ –≤–∞—à–µ–π –≤–µ—Ä—Å–∏–∏ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è)
3. `Add mapper` ‚Üí `By configuration`
4. –í—ã–±–µ—Ä–∏—Ç–µ **Audience**
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - `Included Client Audience`: `rockfile-api`
   - `Add to access token`: ON
   - (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) `Add to ID token`: ON
6. `Save`

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `aud` —Å–æ–¥–µ—Ä–∂–∏—Ç `rockfile-api`.

---

## –§–∞–∑–∞ 2: MVP API (–ö–∞—Ä—Ç–æ—á–∫–∏ –∏ –±–∞–∑–æ–≤—ã–π CRUD)

**–¶–µ–ª—å:** –†–∞–±–æ—Ç–∞—é—â–∏–π CRUD –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤.

### 1.1 –°—Ö–µ–º—ã Pydantic

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 1.1.1 | `ContactCardCreate` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ | –°—Ö–µ–º–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏/–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ |
| 1.1.2 | `ContactCardUpdate` ‚Äî —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –í—Å–µ –ø–æ–ª—è optional |
| 1.1.3 | `ContactCardResponse` ‚Äî –æ—Ç–≤–µ—Ç API | –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ ORM |
| 1.1.4 | `ContactCardListResponse` ‚Äî —Å–ø–∏—Å–æ–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π | `items`, `total`, `page`, `per_page` |

### 1.2 –†–æ—É—Ç–µ—Ä –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 1.2.1 | `GET /api/v1/contacts` ‚Äî —Å–ø–∏—Å–æ–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π | `page`, `per_page`, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏ |
| 1.2.2 | `POST /api/v1/contacts` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ | –í–∞–ª–∏–¥–∞—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—Ç —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ |
| 1.2.3 | `GET /api/v1/contacts/{id}` | –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ ID, 404 –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ |
| 1.2.4 | `PATCH /api/v1/contacts/{id}` | –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |
| 1.2.5 | `DELETE /api/v1/contacts/{id}` | –ú—è–≥–∫–æ–µ –∏–ª–∏ –∂—ë—Å—Ç–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ |

### 1.3 –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–∞ MVP)

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 1.3.1 | `ContactService` ‚Äî –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ DAO | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏, –ø—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å |

### 1.4 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 1.4.1 | –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç–µ—Ä –≤ `fastapi_app` | –ú–∞—Ä—à—Ä—É—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã |
| 1.4.2 | Dependency injection –¥–ª—è —Å–µ—Å—Å–∏–∏ –ë–î | `get_db()` —á–µ—Ä–µ–∑ `yield` |
| 1.4.3 | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ | 404, 422, 500 –≤ –µ–¥–∏–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ |

**–í—ã—Ö–æ–¥:** –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å, —á–∏—Ç–∞—Ç—å, –æ–±–Ω–æ–≤–ª—è—Ç—å –∏ —É–¥–∞–ª—è—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ —á–µ—Ä–µ–∑ Swagger/ReDoc.

---

## –§–∞–∑–∞ 3: –°–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

**–¶–µ–ª—å:** ContactLink (—Å–≤—è–∑–∏ ¬´–∫—Ç–æ –∫–æ–≥–æ –∑–Ω–∞–µ—Ç¬ª) –∏ CRUD –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π. –ö–∞–∂–¥—ã–π —á–µ–ª–æ–≤–µ–∫ ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞; —Å–≤—è–∑–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç –≥—Ä–∞—Ñ –æ—Ç–Ω–æ—à–µ–Ω–∏–π.

### 2.1 –°—Ö–µ–º—ã

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 2.1.1 | `ContactLinkCreate`, `ContactLinkResponse` | –°—Ö–µ–º—ã –¥–ª—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ (contact_a, contact_b, relationship_type, context) |
| 2.1.2 | `ContactInteractionCreate`, `ContactInteractionResponse` | –°—Ö–µ–º—ã –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π |
| 2.1.3 | –î–æ–±–∞–≤–∏—Ç—å `known_through_contact_id` –≤ `ContactCard` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | –ß–µ—Ä–µ–∑ –∫–æ–≥–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª—Å—è |

### 2.2 –†–æ—É—Ç–µ—Ä—ã

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 2.2.1 | `GET/POST /api/v1/contacts/{id}/links` | –°–ø–∏—Å–æ–∫ —Å–≤—è–∑–µ–π –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º –∫–æ–Ω—Ç–∞–∫—Ç–æ–º |
| 2.2.2 | `PATCH/DELETE /api/v1/contacts/{id}/links/{link_id}` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏ |
| 2.2.3 | `GET /api/v1/links` | –í—Å–µ —Å–≤—è–∑–∏ (–¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∞) |
| 2.2.4 | `GET/POST /api/v1/contacts/{id}/interactions` | –°–ø–∏—Å–æ–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π |
| 2.2.5 | `PATCH/DELETE /api/v1/contacts/{id}/interactions/{int_id}` | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ |

### 2.3 –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 2.3.1 | –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ Interaction –æ–±–Ω–æ–≤–ª—è—Ç—å `last_contact_at`, `last_contact_summary` —É ContactCard | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ |
| 2.3.2 | –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ Interaction —Å `promises` ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ `ContactCard.promises` (—Å `interaction_id`, `direction`, `completed_at`) | –°–≤—è–∑—å –æ–±–µ—â–∞–Ω–∏–π: Interaction = –∏—Å—Ç–æ—á–Ω–∏–∫, Card = —Å–≤–æ–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö |
| 2.3.3 | –≠–Ω–¥–ø–æ–∏–Ω—Ç/–¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –æ–±–µ—â–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º (—É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ Card –∏–ª–∏ —Ñ–ª–∞–≥ `completed_at`) | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∏—Å—Ç–æ—Ä–∏–∏ –≤ Interaction |
| 2.3.4 | –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ `GET /contacts/{id}` –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å `links` (—Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã), `interactions` | –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –≥—Ä–∞—Ñ–æ–º —Å–≤—è–∑–µ–π |

**–í—ã—Ö–æ–¥:** –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –≥—Ä–∞—Ñ–æ–º —Å–≤—è–∑–µ–π –∏ –∏—Å—Ç–æ—Ä–∏–µ–π –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è –æ–±–µ—â–∞–Ω–∏–π.

---

## –§–∞–∑–∞ 4: –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

**–¶–µ–ª—å:** –£–¥–æ–±–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ä—Ç–æ—Ç–µ–∫–µ.

### 3.1 –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 3.1.1 | –ü–∞—Ä–∞–º–µ—Ç—Ä `q` –≤ `GET /contacts` | –ü–æ–∏—Å–∫ –ø–æ `full_name`, `email` (ILIKE) |
| 3.1.2 | –§–∏–ª—å—Ç—Ä `relationship_type` | business / personal / other |
| 3.1.3 | –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ `sort` | `name`, `last_contact_at`, `created_at` + `asc`/`desc` |

### 3.2 –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 3.2.1 | –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–∏—Ç—å `tsvector` –∏ GIN-–∏–Ω–¥–µ–∫—Å | –ü–æ–∏—Å–∫ –ø–æ –∑–∞–º–µ—Ç–∫–∞–º, –∏–Ω—Ç–µ—Ä–µ—Å–∞–º |
| 3.2.2 | –≠–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/v1/search?q=` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `to_tsquery` |

### 3.3 –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 3.3.1 | `has_birthday_soon` (N –¥–Ω–µ–π) | –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –î–† –≤ –±–ª–∏–∂–∞–π—à–∏–µ N –¥–Ω–µ–π |
| 3.3.2 | `last_contact_before` (N –¥–Ω–µ–π) | –° –∫–µ–º –¥–∞–≤–Ω–æ –Ω–µ –æ–±—â–∞–ª–∏—Å—å |

**–í—ã—Ö–æ–¥:** –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ä—Ç–æ—Ç–µ–∫–µ.

---

## –§–∞–∑–∞ 5: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)

**–¶–µ–ª—å:** –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–∞—Ä—Ç–æ—á–∫–∏.

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 4.1 | –î–æ–±–∞–≤–∏—Ç—å `User` –∏ `user_id` –≤ `ContactCard` | –°–≤—è–∑—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º |
| 4.2 | JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–∏–ª–∏ OAuth2) | Middleware/Depends –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ |
| 4.3 | –≠–Ω–¥–ø–æ–∏–Ω—Ç `POST /auth/login` (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è) | –í—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ |
| 4.4 | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ `user_id` | –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö |

**–í—ã—Ö–æ–¥:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º—É–ª—å—Ç–∏–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

---

## –§–∞–∑–∞ 6: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

**–¶–µ–ª—å:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 5.1 | –¢–µ–≥–∏ (`ContactTag`, many-to-many —Å ContactCard) | –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ñ–µ—Ä–∞–º, –ø—Ä–æ–µ–∫—Ç–∞–º |
| 5.2 | –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (`ContactReminder`) | –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ follow-up, –î–† |
| 5.3 | –°–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ (`ContactLink`) | –ö—Ç–æ —Å –∫–µ–º —Å–≤—è–∑–∞–Ω |
| 5.4 | –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç (CSV, JSON) | –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö |

**–í—ã—Ö–æ–¥:** –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—Ç–µ–∫–∞ —Å —Ç–µ–≥–∞–º–∏, –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏ –∏ —Å–≤—è–∑—è–º–∏.

---

## –§–∞–∑–∞ 7: –í–µ–±-—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (HTML, CSS, JS)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è **–ø–æ—Å–ª–µ** —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ API (API-first).

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 6.1 | HTML-—à–∞–±–ª–æ–Ω—ã, CSS-—Å—Ç–∏–ª–∏ | –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫, —Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≤–µ–±, –Ω–µ SPA) |
| 6.2 | JavaScript –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API (fetch/XHR) | CRUD, –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ (–∏–ª–∏ —Å –Ω–µ–π) |
| 6.3 | CORS, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–∞ —Å FastAPI |
| 6.4 | –ü–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä—ã –≤ UI | –£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∏—Å–∫–∞ |

---

## –§–∞–∑–∞ 8: –ò–ò-–∞–≥–µ–Ω—Ç (–ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞)

**–¶–µ–ª—å:** –ê–≥–µ–Ω—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—Ç–µ–∫–∏ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫.

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 7.1 | API/–≤–æ—Ä–∫–µ—Ä: –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –¥–Ω—è—Ö —Ä–æ–∂–¥–µ–Ω–∏—è | –ó–∞ N –¥–Ω–µ–π –¥–æ –î–† –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏ —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏ |
| 7.2 | –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –æ–±–µ—â–∞–Ω–∏—è—Ö –∏ `follow_up_by` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö/–ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞—Ö |
| 7.3 | ¬´–ó–∞–±—ã—Ç—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã¬ª ‚Äî —Å –∫–µ–º –¥–∞–≤–Ω–æ –Ω–µ –æ–±—â–∞–ª—Å—è | –°–ø–∏—Å–æ–∫ –ø–æ `last_contact_at` + –∫—Ä–∞—Ç–∫–∞—è –≤—ã–∂–∏–º–∫–∞ |
| 7.4 | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤—Å—Ç—Ä–µ—á–µ: –ø–∞–º—è—Ç–∫–∞ –ø–æ –∫–æ–Ω—Ç–∞–∫—Ç—É | –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–Ω—Ç–∞–∫—Ç, –æ–±–µ—â–∞–Ω–∏—è, –∏–Ω—Ç–µ—Ä–µ—Å—ã |
| 7.5 | –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ LLM) | –ü–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º, –∑–∞–º–µ—Ç–∫–∞–º, —Å–µ–º–µ–π–Ω—ã–º —Å–æ–±—ã—Ç–∏—è–º |
| 7.6 | –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç | –î–†, –æ–±–µ—â–∞–Ω–∏—è, –∫–æ–Ω—Ç–∞–∫—Ç—ã –±–µ–∑ –æ–±—â–µ–Ω–∏—è |

**–í—ã—Ö–æ–¥:** –ò–ò-–∞–≥–µ–Ω—Ç –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å/–≤–æ—Ä–∫–µ—Ä, —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Å API.

---

## –§–∞–∑–∞ 9: –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞)

**–¶–µ–ª—å:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º–æ–µ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–¥–∞–Ω–Ω—ã–µ –≤ –º–æ–±–∏–ª–∫–µ ‚Üí –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –≤–µ–± –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç).

| # | –ó–∞–¥–∞—á–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---|--------|-----------|
| 8.1 | –¢–æ—Ç –∂–µ REST API ‚Äî –æ—Å–Ω–æ–≤–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ | –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã |
| 8.2 | –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–æ–Ω–ª–∞–π–Ω-first –∏–ª–∏ –≥–∏–±—Ä–∏–¥) | –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ |
| 8.3 | Flutter / React Native / –Ω–∞—Ç–∏–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç | iOS –∏ Android |
| 8.4 | Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ—Ç –ò–ò-–∞–≥–µ–Ω—Ç–∞) | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Firebase/APNs |
| 8.5 | –û—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ + –æ—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |

**–í—ã—Ö–æ–¥:** –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º–æ–µ —Å –≤–µ–±-–≤–µ—Ä—Å–∏–µ–π —á–µ—Ä–µ–∑ –æ–±—â–∏–π API.

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –§–∞–∑–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
|------|-----------|-------------|
| 0 | –í—ã—Å–æ–∫–∏–π | ‚Äî |
| 1 | –í—ã—Å–æ–∫–∏–π | 0 |
| 2 | –í—ã—Å–æ–∫–∏–π | 1 |
| 3 | –í—ã—Å–æ–∫–∏–π | 2 |
| 4 | –°—Ä–µ–¥–Ω–∏–π | 2, 3 |
| 5 | –°—Ä–µ–¥–Ω–∏–π | 2, 3 |
| 6 | –ù–∏–∑–∫–∏–π | 1‚Äì5 |
| 7 | –°—Ä–µ–¥–Ω–∏–π | 1‚Äì5 (API-first: —Å–Ω–∞—á–∞–ª–∞ API) |
| 8 | –ù–∏–∑–∫–∏–π | 1‚Äì6 |
| 9 | –ù–∏–∑–∫–∏–π | 1‚Äì6 |

---

## –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã

- [ ] –ü—Ä–æ—à–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ñ–∞–∑—ã
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –∞–∫—Ç—É–∞–ª—å–Ω–∞ (Swagger)

---

## –û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ)

| –§–∞–∑–∞ | –û—Ü–µ–Ω–∫–∞ |
|------|--------|
| 0 | 0.5‚Äì1 –¥–µ–Ω—å |
| 1 | 1‚Äì2 –¥–Ω—è |
| 2 | 2‚Äì3 –¥–Ω—è |
| 3 | 2‚Äì3 –¥–Ω—è (—Å –ª–æ–≥–∏–∫–æ–π –æ–±–µ—â–∞–Ω–∏–π) |
| 4 | 1‚Äì2 –¥–Ω—è |
| 5 | 2‚Äì3 –¥–Ω—è |
| 6 | 3‚Äì5 –¥–Ω–µ–π |
| 7 | 5‚Äì8 –¥–Ω–µ–π (HTML/CSS/JS) |
| 8 | 5‚Äì10 –¥–Ω–µ–π (–ò–ò-–∞–≥–µ–Ω—Ç) |
| 9 | 15‚Äì25 –¥–Ω–µ–π (–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ) |

**MVP (—Ñ–∞–∑—ã 0‚Äì3):** –ø—Ä–∏–º–µ—Ä–Ω–æ 6‚Äì9 –¥–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
